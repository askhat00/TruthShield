<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text Checker - TruthShield</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
span, p { color: white; }
body { background: radial-gradient(circle at top, #0c0f12 0%, #050607 100%); color: #d9e2ec; font-family: "Inter", sans-serif; min-height: 100vh; }
.navbar { background: rgba(15,20,25,0.7); backdrop-filter: blur(10px); border-bottom:1px solid #1b2a2f; }
.navbar-brand { color:#00ffcc !important; font-weight:600; }
.btn-glow { background-color:#00ffcc; border:none; color:#000; border-radius:10px; font-weight:600; transition:.3s; }
.btn-glow:hover { box-shadow:0 0 12px #00ffccaa; background-color:#00e6b3; }
.card { background: rgba(20,25,30,0.85); border:1px solid #1b2a2f; border-radius:16px; box-shadow:0 0 10px #00ffcc25; margin-bottom:20px; }
.card-title { color:#00ffcc; font-weight:600; }
textarea { background: rgba(15,20,25,0.8); color:#d9e2ec; border:1px solid #1b2a2f; border-radius:12px; padding:12px; width:100%; min-height:200px; resize:none; }
.fade-in { animation: fadeIn 0.6s ease forwards; }
@keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
.logout-btn { background: linear-gradient(90deg,#00ffcc,#00ffaa); color:#0a0a0a; border:none; border-radius:12px; padding:10px 26px; font-weight:600; font-size:16px; cursor:pointer; transition:.25s; }
.logout-btn:hover { background: linear-gradient(90deg,#00ffaa,#00ffcc); color:white; transform:scale(1.05); box-shadow:0 0 18px #00ffcc,0 0 35px #00ffaa; }
</style>
</head>
<body>
<nav class="navbar navbar-dark">
<div class="container-fluid px-4 py-2">
  <a class="navbar-brand" href="/dashboard/">TruthShield</a>
  <div class="d-flex align-items-center">
    <span id="username" class="me-4"></span>
    <a href="#" class="logout-btn" onclick="logout()">Logout</a>
  </div>
</div>
</nav>

<div class="container py-5">
<h2 class="fw-bold mb-4 fade-in">Text Checker</h2>

<div class="card p-4 fade-in">
  <h5 class="card-title mb-3">Paste your text below</h5>
  <textarea id="text-input" placeholder="Enter text to verify..."></textarea>
  <div class="mt-3 text-end">
    <button class="btn btn-glow" onclick="checkText()">Start Check</button>
    <a href="/file-checker/" class="btn btn-glow ms-2">Go to File Checker</a>
  </div>
</div>

<div id="analysis-result" class="card p-4 mt-4 fade-in" style="display:none;"></div>

</div>

<script>
async function loadProfile() {
    const token = localStorage.getItem('access');
    if(!token){ window.location.href='/login/'; return; }
    const res = await fetch('/api/profile/', { headers: {'Authorization': `Bearer ${token}`}});
    if(res.status===403||res.status===401){ localStorage.removeItem('access'); window.location.href='/login/'; return; }
    const data = await res.json();
    document.getElementById('username').textContent = `Hi, ${data.username}`;
}

function logout(){ localStorage.clear(); window.location.href='/login/'; }

async function checkText() {
    const text = document.getElementById("text-input").value.trim();
    if(!text) { alert("Please enter some text"); return; }

    const token = localStorage.getItem('access');
    const res = await fetch('/api/analyze-text/', {
        method:'POST',
        headers:{ 'Content-Type':'application/json', 'Authorization': `Bearer ${token}` },
        body: JSON.stringify({text})
    });
    const data = await res.json();
    if(data.error){ alert(data.error); return; }

    const container = document.getElementById("analysis-result");
    container.style.display='block';
    container.innerHTML=`
        <h5 class="card-title">Analysis Report</h5>
        <p><strong>Final Decision:</strong> ${data.label}</p>
        <p><strong>Probability:</strong> ${(data.probability*100).toFixed(2)}%</p>
        <p><strong>Sources:</strong> ${data.sources.join(", ")||"None"}</p>
        <p><strong>Signs of Falsification:</strong> ${data.signs_of_falsification.join(", ")||"None"}</p>
        <a href="/api/report/${data.report_id}/pdf/" class="btn btn-glow btn-sm me-2" target="_blank">Export PDF</a>
        <a href="/api/report/${data.report_id}/json/" class="btn btn-glow btn-sm" target="_blank">Export JSON</a>
    `;
}

loadProfile();
</script>
</body>
</html>
